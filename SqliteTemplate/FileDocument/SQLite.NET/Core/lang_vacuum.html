<!DOCTYPE html>
<!-- saved from url=(0114)file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/lang_vacuum.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="./lang_vacuum_files/sqlite.css" rel="stylesheet">
<title _msttexthash="6035861" _msthash="0">真空</title>
<!-- path= -->
</head>
<body>
<div class="nosearch">
<a href="https://www.sqlite.org/index.html">
<img class="logo" src="./lang_vacuum_files/sqlite370_banner.gif" alt="SQLite" border="0" _mstalt="70863" _msthash="1">
</a>
<div><!-- IE hack to prevent disappearing logo --></div>
<div class="tagline desktoponly" _msttexthash="53246063" _msthash="2">小。快。可靠。<br _istranslated="1">选择任意三个。</div>
<div class="menu mainmenu">
<ul>
<li><a href="https://www.sqlite.org/index.html" _msttexthash="2136498" _msthash="3">家</a>
</li><li class="mobileonly" _msthidden="1"><a href="https://www.sqlite.org/javascript:void(0)" onclick="toggle_div(&quot;submenu&quot;)" _msttexthash="45591" _msthidden="1" _msthash="4">Menu</a>
</li><li class="wideonly"><a href="https://www.sqlite.org/about.html" _msttexthash="5448781" _msthash="5">大约</a>
</li><li class="desktoponly"><a href="https://www.sqlite.org/docs.html" _msttexthash="5144373" _msthash="6">文档</a>
</li><li class="desktoponly"><a href="https://www.sqlite.org/download.html" _msttexthash="5638321" _msthash="7">下载</a>
</li><li class="wideonly"><a href="https://www.sqlite.org/copyright.html" _msttexthash="9675445" _msthash="8">许可证</a>
</li><li class="desktoponly"><a href="https://www.sqlite.org/support.html" _msttexthash="4993053" _msthash="9">支持</a>
</li><li class="desktoponly"><a href="https://www.sqlite.org/prosupport.html" _msttexthash="5377151" _msthash="10">购买</a>
</li><li class="search" id="search_menubutton" _msthidden="1" style="display: none;">
<a href="https://www.sqlite.org/javascript:void(0)" onclick="toggle_search()" _msttexthash="74607" _msthidden="1" _msthash="11">Search</a>
</li></ul>
</div>
<div class="menu submenu" id="submenu" _msthidden="5">
<ul _msthidden="5">
<li _msthidden="1"><a href="https://www.sqlite.org/about.html" _msttexthash="60892" _msthidden="1" _msthash="12">About</a>
</li><li _msthidden="1"><a href="https://www.sqlite.org/docs.html" _msttexthash="234962" _msthidden="1" _msthash="13">Documentation</a>
</li><li _msthidden="1"><a href="https://www.sqlite.org/download.html" _msttexthash="113308" _msthidden="1" _msthash="14">Download</a>
</li><li _msthidden="1"><a href="https://www.sqlite.org/support.html" _msttexthash="100646" _msthidden="1" _msthash="15">Support</a>
</li><li _msthidden="1"><a href="https://www.sqlite.org/prosupport.html" _msttexthash="113477" _msthidden="1" _msthash="16">Purchase</a>
</li></ul>
</div>
<div class="searchmenu" id="searchmenu" _msthidden="3">
<form method="GET" action="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/search" _msthidden="3">
<select name="s" id="searchtype" _msthidden="2">
<option value="d" _msttexthash="416429" _msthidden="1" _msthash="17">Search Documentation</option>
<option value="c" _msttexthash="276705" _msthidden="1" _msthash="18">Search Changelog</option>
</select>
<input type="text" name="q" id="searchbox" value="">
<input type="submit" value="Go" _msthidden="A" _mstvalue="18005" _msthash="19">
</form>
</div>
</div>
<script>
function toggle_div(nm) {
var w = document.getElementById(nm);
if( w.style.display=="block" ){
w.style.display = "none";
}else{
w.style.display = "block";
}
}
function toggle_search() {
var w = document.getElementById("searchmenu");
if( w.style.display=="block" ){
w.style.display = "none";
} else {
w.style.display = "block";
setTimeout(function(){
document.getElementById("searchbox").focus()
}, 30);
}
}
function div_off(nm){document.getElementById(nm).style.display="none";}
window.onbeforeunload = function(e){div_off("submenu");}
/* Disable the Search feature if we are not operating from CGI, since */
/* Search is accomplished using CGI and will not work without it. */
if( !location.origin || 1 ){
document.getElementById("search_menubutton").style.display = "none";
}
/* Used by the Hide/Show button beside syntax diagrams, to toggle the */
function hideorshow(btn,obj){
var x = document.getElementById(obj);
var b = document.getElementById(btn);
if( x.style.display!='none' ){
x.style.display = 'none';
b.innerHTML='show';
}else{
x.style.display = '';
b.innerHTML='hide';
}
return false;
}

</script>
<div class="fancy">
<div class="nosearch">
<div class="fancy_title" _msttexthash="6035861" _msthash="20">真空</div>
</div>




<h1 id="syntax" _msttexthash="7822230" _msthash="21"><span _istranslated="1">1. </span>语法</h1>
<p><b><a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/syntax/vacuum-stmt.html" _msttexthash="20994441" _msthash="22">vacuum-stmt 中：</a></b>
<button id="x0fc49388" onclick="hideorshow(&quot;x0fc49388&quot;,&quot;x74e14988&quot;)" _msttexthash="7070024" _msthash="23">隐藏</button></p>
 <div id="x74e14988" class="imgcontainer">
 <div style="max-width:599px"><svg xmlns="http://www.w3.org/2000/svg" class="pikchr" viewBox="0 0 599.669 64.8" width="599.669" height="64.8">
<circle cx="5" cy="17" r="3.6" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></circle>
<polygon points="32,17 20,21 20,12" style="fill:rgb(0,0,0)"></polygon>
<path d="M9,17L26,17" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<path d="M47,32L108,32A15 15 0 0 0 123 17A15 15 0 0 0 108 2L47,2A15 15 0 0 0 32 17A15 15 0 0 0 47 32Z" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="78" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central" _mstTextHash="6035861" _mstHash="24">真空</text>
<polygon points="165,47 153,51 153,43" style="fill:rgb(0,0,0)"></polygon>
<path d="M123,17 L 131,17 Q 138,17 138,32 L 138,32 Q 138,47 149,47 L 159,47" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<path d="M180,62L276,62A15 15 0 0 0 292 47L292,47A15 15 0 0 0 276 32L180,32A15 15 0 0 0 165 47L165,47A15 15 0 0 0 180 62Z" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="228" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central" _mstTextHash="11747619" _mstHash="25">架构名称</text>
<polygon points="333,17 322,21 322,12" style="fill:rgb(0,0,0)"></polygon>
<path d="M292,47 L 299,47 Q 307,47 307,32 L 307,32 Q 307,17 317,17 L 327,17" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<polygon points="375,47 363,51 363,43" style="fill:rgb(0,0,0)"></polygon>
<path d="M333,17 L 341,17 Q 348,17 348,32 L 348,32 Q 348,47 359,47 L 369,47" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<path d="M390,62L417,62A15 15 0 0 0 432 47L432,47A15 15 0 0 0 417 32L390,32A15 15 0 0 0 375 47L375,47A15 15 0 0 0 390 62Z" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="403" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central" _mstTextHash="1914640" _mstHash="26">到</text>
<polygon points="455,47 443,51 443,43" style="fill:rgb(0,0,0)"></polygon>
<path d="M432,47L449,47" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<path d="M470,62L524,62A15 15 0 0 0 539 47L539,47A15 15 0 0 0 524 32L470,32A15 15 0 0 0 455 47L455,47A15 15 0 0 0 470 62Z" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="497" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central" _mstTextHash="6984926" _mstHash="27">文件名</text>
<polygon points="590,17 578,21 578,12" style="fill:rgb(0,0,0)"></polygon>
<path d="M539,47 L 546,47 Q 554,47 554,32 L 554,32 Q 554,17 569,17 L 569,17 L 584,17" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<circle cx="593" cy="17" r="3.6" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></circle>
<path d="M123,17L578,17" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
</svg>
</div>
</div>


<h1 id="description" _msttexthash="7789041" _msthash="28"><span _istranslated="1">2. </span>描述</h1>
<p _msttexthash="600069756" _msthash="29">VACUUM 命令将重新构建数据库文件，将其重新打包为最小的
 磁盘空间量。有几个
 应用程序可能执行此作的原因：</p><ul>
  <li> <p _msttexthash="1977556230" _msthash="30">除非 SQLite 以 “auto_vacuum=FULL” 模式运行时，当
 从数据库文件中删除的数据量 它留下为空
 space 或 “free” 数据库页面。这意味着数据库文件可能会
 大于绝对必要的。运行 VACUUM 以重建
 database 回收此空间并减小 database 文件的大小。</p></li><li> <p _msttexthash="2192757333" _msthash="31">频繁的插入、更新和删除可能会导致数据库文件
 变得碎片化 - 单个表或索引的数据分散
 围绕数据库文件。运行 VACUUM 可确保每个表和
 index 主要连续存储在 database 文件中。在一些
 的情况下，VACUUM 还可以减少
 数据库，从而进一步减小数据库文件的大小。</p></li><li> <p _msttexthash="3005189837" _msthash="32">从 SQLite 数据库中删除内容时，内容不会
 通常会被擦除，但用于保存内容的空间被标记为
 可供重复使用。这可以允许恢复已删除的内容
 由黑客或法医分析。运行 VACUUM 将清理数据库
 已删除内容的所有痕迹，从而防止对手恢复
 已删除的内容。以这种方式使用 VACUUM 是设置 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_secure_delete" _istranslated="1">PRAGMA secure_delete=ON</a> 的替代方法。</p></li><li> <p _msttexthash="3658462613" _msthash="33">通常，数据库<a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_page_size" _istranslated="1">page_size</a>以及数据库是否
 支持<a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">auto_vacuum</a>必须在数据库文件之前配置
 实际创建。但是，当不处于<a href="https://www.sqlite.org/wal.html" _istranslated="1">预写日志</a>模式时，现有数据库的 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_page_size" _istranslated="1">page_size</a> 和/或 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">auto_vacuum</a> 属性可能是
 通过使用 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_page_size" _istranslated="1">page_size</a> 和/或 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">pragma auto_vacuum</a> pragma 进行更改，然后立即执行 VACUUMing作
 数据库。在<a href="https://www.sqlite.org/wal.html" _istranslated="1">预写日志</a>模式下，只能使用 VACUUM 更改 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">auto_vacuum</a> 支持属性。</p></li></ul>

<p _msttexthash="547285128" _msthash="34">默认情况下，VACUUM 在主数据库上运行。可以通过将适当的<span class="yyterm" _istranslated="1">架构名称</span>附加到 VACUUM 语句来对<a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/lang_attach.html" _istranslated="1">附加的数据库</a>执行 vacuum作。</p><p _msttexthash="1034200557" _msthash="35"><b _istranslated="1">兼容性警告：</b>对附加数据库执行 vacuum作的能力是
在 <a href="https://www.sqlite.org/releaselog/3_15_0.html" _istranslated="1">3.15.0 版本</a>（2016-10-14）中添加。在此之前<span class="yyterm" _istranslated="1">，添加到</span>
VACUUM 语句将被静默忽略，而 “main” 架构将被
吸尘。</p>

<a name="vacuuminto"></a>

<h2 id="vacuum_with_an_into_clause" _msttexthash="25463711" _msthash="36"><span _istranslated="1">2.1. </span>带有 INTO 子句的 VACUUM</h2>

<p _msttexthash="1326387439" _msthash="37">如果包含 INTO 子句，则原始数据库文件为
未更改，并在名为
参数添加到 INTO 子句中。
参数是标量<a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/lang_expr.html" _istranslated="1">表达式</a>，例如文本文本。
新数据库将包含相同的
逻辑内容作为原始数据库，完全清理。</p><p _msttexthash="3651603787" _msthash="38">带有 INTO 子句的 VACUUM 命令是<a href="https://www.sqlite.org/backup.html" _istranslated="1">备份 API</a> 的替代方法，用于生成实时数据库的备份副本。
使用 VACUUM INTO 的优点是，生成的备份
数据库的大小最小，因此文件系统的数量最小
I/O 可能会减少。此外，所有已删除的内容都会从
备份，不留任何取证痕迹。另一方面
<a href="https://www.sqlite.org/backup.html" _istranslated="1">备份 API</a> 使用的 CPU 周期更少，并且可以执行
增量。</p><p _msttexthash="1061148075" _msthash="39">INTO 子句中的文件名可以是任意 SQL 表达式
的计算结果为 string。
由 INTO 子句命名的文件以前不得存在，或者
否则它必须为空文件，否则 VACUUM INTO 命令将
fail 并出现错误。</p><p _msttexthash="227564584" _msthash="40"><a href="https://www.sqlite.org/uri.html" _istranslated="1">如果 URI</a> 文件名
已启用。
如果满足以下任一条件，则启用 URL 文件名：</p><ul>
<li _msttexthash="71798883" _msthash="41">SQLite 库是使用 <a href="https://www.sqlite.org/compile.html#use_uri" _istranslated="1">-DSQLITE_USE_URI=1</a> 编译的。</li><li _msttexthash="233048517" _msthash="42"><a href="https://www.sqlite.org/c3ref/config.html" _istranslated="1">sqlite3_config</a>（<a href="https://www.sqlite.org/c3ref/c_config_covering_index_scan.html#sqliteconfiguri" _istranslated="1">SQLITE_CONFIG_URI，1</a>） 接口是
 在启动时调用。</li><li _msttexthash="180080784" _msthash="43">运行 VACUUM INTO 的<a href="https://www.sqlite.org/c3ref/sqlite3.html" _istranslated="1">数据库连接</a>
 语句最初使用 <a href="https://www.sqlite.org/c3ref/c_open_autoproxy.html" _istranslated="1">SQLITE_OPEN_URI</a> 标志打开。</li></ul>

<p><font _mstmutation="1" _msttexthash="2722551169" _msthash="44">VACUUM INTO 命令是事务性的，因为
生成的输出数据库是
原始数据库。但是，如果 VACUUM INTO 命令为
被计划外关闭或断电打断，然后
生成的 output database 可能不完整且已损坏。
此外，SQLite 不调用 fsync（） 或 FlushFileBuffers（）
以确保它已达到
完成前的非易失性存储。</font><a name="howvacuumworks"></a>

</p><h1 id="how_vacuum_works" _msttexthash="27830621" _msthash="45"><span _istranslated="1">3. </span>VACUUM 的工作原理</h1>

<p _msttexthash="2611162567" _msthash="46">VACUUM 命令的工作原理是将数据库的内容复制到
临时数据库文件，然后用
内容。覆盖原始 URL 时，回滚
journal 或<a href="https://www.sqlite.org/wal.html" _istranslated="1">预写日志</a> WAL 文件的使用方式与任何
other 数据库事务。这意味着，当对数据库执行 VACUUM作时，
在 free 中需要高达原始数据库文件大小的两倍
磁盘空间。</p><p _msttexthash="728106535" _msthash="47">VACUUM INTO 命令的工作方式相同，只是它使用文件
named 代替临时数据库，并省略
将 vacuum 数据库复制回原始数据库顶部的步骤。</p><p _msttexthash="112174673" _msthash="48">VACUUM 命令可以更改任何<a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/lang_createtable.html#rowid" _istranslated="1"></a>
没有显式 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/lang_createtable.html#rowid" _istranslated="1">INTEGER PRIMARY KEY</a> 的表。</p>

<p _msttexthash="3467756188" _msthash="49">如果数据库上有打开的事务，则 VACUUM 将失败
连接，该连接正在尝试运行 VACUUM.未完成的 SQL
语句通常使读取事务保持打开状态，因此 VACUUM
如果同一连接上有未完成的 SQL 语句，则可能会失败。
VACUUM（但不是 VACUUM INTO）是一个写入作，因此如果另一个
数据库连接持有阻止写入的锁，则
VACUUM 将失败。</p><p _msttexthash="4015620089" _msthash="50">使用 VACUUM 命令的替代方法
删除数据后回收空间是自动 vacuum 模式，使用
<a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">auto_vacuum</a> pragma.为数据库启用 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">auto_vacuum</a> 时
删除数据后可能会回收空闲页面，从而导致文件缩小，
而无需使用 VACUUM 重建整个数据库。但是，使用 <a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">auto_vacuum</a> 可能会导致额外的数据库文件碎片。<a href="file:///E:/Code/VsStudio/Jingan567/LcDataBaseCoverAll/SqliteTemplate/FileDocument/SQLite.NET/Core/pragma.html#pragma_auto_vacuum" _istranslated="1">auto_vacuum</a> 不会像 VACUUM 那样压缩数据库的部分填充页面。</p>
<p align="center"><small><i _msttexthash="77562888" _msthash="51">此页面最后修改于 <a href="https://sqlite.org/docsrc/honeypot" id="mtimelink" data-href="https://sqlite.org/docsrc/finfo/pages/lang_vacuum.in?m=d66fef5b60" _istranslated="1">2023-12-05 14：43：20</a> UTC</i></small></p>

</div></body></html>